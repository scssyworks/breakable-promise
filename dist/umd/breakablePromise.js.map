{"version":3,"file":"breakablePromise.js","sources":["../../node_modules/@babel/runtime/helpers/arrayLikeToArray.js","../../node_modules/@babel/runtime/helpers/arrayWithoutHoles.js","../../node_modules/@babel/runtime/helpers/iterableToArray.js","../../node_modules/@babel/runtime/helpers/unsupportedIterableToArray.js","../../node_modules/@babel/runtime/helpers/nonIterableSpread.js","../../node_modules/@babel/runtime/helpers/toConsumableArray.js","../../node_modules/@babel/runtime/helpers/classCallCheck.js","../../node_modules/@babel/runtime/helpers/createClass.js","../../node_modules/@babel/runtime/helpers/classPrivateFieldGet.js","../../node_modules/@babel/runtime/helpers/classPrivateFieldSet.js","../../src/helpers/index.ts","../../node_modules/is-promise/index.js","../../node_modules/@babel/runtime/helpers/defineProperty.js","../../src/EventEmitter/index.ts","../../src/Error/index.ts","../../src/index.ts"],"sourcesContent":["function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nmodule.exports = _arrayLikeToArray;","var arrayLikeToArray = require(\"./arrayLikeToArray\");\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}\n\nmodule.exports = _arrayWithoutHoles;","function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}\n\nmodule.exports = _iterableToArray;","var arrayLikeToArray = require(\"./arrayLikeToArray\");\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}\n\nmodule.exports = _unsupportedIterableToArray;","function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nmodule.exports = _nonIterableSpread;","var arrayWithoutHoles = require(\"./arrayWithoutHoles\");\n\nvar iterableToArray = require(\"./iterableToArray\");\n\nvar unsupportedIterableToArray = require(\"./unsupportedIterableToArray\");\n\nvar nonIterableSpread = require(\"./nonIterableSpread\");\n\nfunction _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}\n\nmodule.exports = _toConsumableArray;","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","function _classPrivateFieldGet(receiver, privateMap) {\n  var descriptor = privateMap.get(receiver);\n\n  if (!descriptor) {\n    throw new TypeError(\"attempted to get private field on non-instance\");\n  }\n\n  if (descriptor.get) {\n    return descriptor.get.call(receiver);\n  }\n\n  return descriptor.value;\n}\n\nmodule.exports = _classPrivateFieldGet;","function _classPrivateFieldSet(receiver, privateMap, value) {\n  var descriptor = privateMap.get(receiver);\n\n  if (!descriptor) {\n    throw new TypeError(\"attempted to set private field on non-instance\");\n  }\n\n  if (descriptor.set) {\n    descriptor.set.call(receiver, value);\n  } else {\n    if (!descriptor.writable) {\n      throw new TypeError(\"attempted to set read only private field\");\n    }\n\n    descriptor.value = value;\n  }\n\n  return value;\n}\n\nmodule.exports = _classPrivateFieldSet;","export const setImmediateFn = typeof setImmediate === 'function'\n    ? setImmediate\n    : function (cb: () => void): void {\n        setTimeout(cb, 0);\n    };\n\nexport const isCallable = (callable: (...args: any[]) => any): boolean => {\n    return typeof callable === 'function';\n};","module.exports = isPromise;\nmodule.exports.default = isPromise;\n\nfunction isPromise(obj) {\n  return !!obj && (typeof obj === 'object' || typeof obj === 'function') && typeof obj.then === 'function';\n}\n","function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;","import { setImmediateFn as setImmediate } from \"../helpers\";\n\nexport class EventEmitter {\n    events = {} as { [type: string]: ((...args: any[]) => void)[] };\n    listenerId = Math.round(Math.random() * 1000000000000);\n\n    on<T = any>(eventType: string, cb: (...args: T[]) => void): EventEmitter {\n        this.events[eventType] = this.events[eventType] || [];\n        this.events[eventType].push(cb);\n        return this;\n    }\n\n    off<T = any>(eventType?: string, cb?: (...args: T[]) => void): EventEmitter {\n        if (typeof eventType !== 'string') {\n            for (const currEventType in this.events) {\n                this.events[currEventType].length = 0;\n            }\n        } else if (typeof cb !== 'function') {\n            if (this.events[eventType]) {\n                this.events[eventType].length = 0;\n                delete this.events[eventType];\n            }\n        } else if (this.events[eventType]) {\n            this.events[eventType].splice(this.events[eventType].indexOf(cb), 1);\n            if (this.events[eventType].length === 0) {\n                delete this.events[eventType];\n            }\n        }\n        return this;\n    }\n\n    once<T = any>(eventType: string, cb: (...args: T[]) => void): EventEmitter {\n        const tempCallback = (...args: T[]) => {\n            cb.apply(this, args);\n            setImmediate(() => {\n                this.off(eventType, tempCallback);\n            });\n        };\n        this.on(eventType, tempCallback);\n        return this;\n    }\n\n    emit<T = any>(eventType: string, ...args: T[]): void {\n        if (this.events[eventType]) {\n            this.events[eventType].forEach(fn => {\n                fn.apply(this, args);\n            });\n        }\n    }\n}","export class Error<T = any> {\n    _error: T | null = null;\n    isCaught = false;\n    constructor(err?: T | null) {\n        // eslint-disable-next-line\n        if (err != null) {\n            this.error = err;\n        }\n    }\n    set error(e: T | null) {\n        this._error = e;\n    }\n    get error(): T | null {\n        this.isCaught = true;\n        return this._error;\n    }\n}","import { setImmediateFn as setImmediate } from \"./helpers\";\nimport isPromise from 'is-promise';\nimport { EventEmitter } from \"./EventEmitter\";\nimport { Error } from \"./Error\";\n\nenum PromiseStates {\n    PENDING,\n    FULFILLED,\n    REJECTED,\n    BROKEN\n}\n\nenum EventTypes {\n    SUCCESS = 'promisesuccess',\n    FAILED = 'promisefailed',\n    BREAKABLE = 'promisebreak'\n}\n\ntype VoidFn = () => void;\n\ntype CallBreak = null | void | VoidFn;\n\ninterface PromiseFunction<T> {\n    (\n        resolve: (input?: T | null) => void,\n        reject: (error?: T | null) => void,\n        breakPromise?: (fn?: CallBreak) => void\n    ): void;\n}\n\ninterface Thenable<T> {\n    (result?: T | null): (T | any | BreakablePromise<T | any> | Promise<T | any>);\n}\n\ntype PromiseLike<T> = Promise<T> | BreakablePromise<T>;\n\nexport class BreakablePromise<T> {\n    #state: number;\n    #isBreakable = false;\n    #callBreak: CallBreak = null;\n    #data: T | null | undefined;\n    #error: Error<T>;\n    #emitter: EventEmitter;\n    constructor(fn: PromiseFunction<T>) {\n        this.#state = PromiseStates.PENDING;\n        this.#data = null;\n        this.#error = new Error<T>();\n        this.#emitter = new EventEmitter();\n        try {\n            fn.call(\n                this,\n                (data?: T | null) => {\n                    setImmediate(() => {\n                        if (!this.isBroken()) {\n                            this.#data = data;\n                            this.#state = PromiseStates.FULFILLED;\n                            this.#emitter.emit<T>(EventTypes.SUCCESS);\n                            this.#emitter.off(EventTypes.BREAKABLE);\n                        }\n                    });\n                },\n                (error?: T | null) => {\n                    setImmediate(() => {\n                        if (!this.isBroken()) {\n                            this.#error = new Error<T>(error);\n                            this.#state = PromiseStates.REJECTED;\n                            this.#emitter.emit<T>(EventTypes.FAILED);\n                            this.#emitter.off(EventTypes.BREAKABLE);\n                        }\n                    });\n                },\n                (cb: CallBreak) => {\n                    if (typeof cb === 'function') {\n                        this.#isBreakable = true;\n                        this.#callBreak = cb;\n                        this.#emitter.emit<VoidFn>(EventTypes.BREAKABLE, this.#callBreak);\n                    } else {\n                        this.#emitter.off(EventTypes.BREAKABLE);\n                    }\n                }\n            );\n        } catch (error) {\n            this.#state = PromiseStates.REJECTED;\n            this.#error = new Error<T>(error);\n        }\n    }\n\n    #isFullfilled = (): boolean => {\n        return this.#state === PromiseStates.FULFILLED;\n    }\n\n    #isPending = (): boolean => {\n        return this.#state === PromiseStates.PENDING;\n    }\n\n    #checkState = (\n        resolve: (result: any) => void,\n        reject: (error: any) => void,\n        fn?: Thenable<T>,\n    ): void => {\n        if (!this.isBroken()) {\n            let result: any;\n            if (typeof fn === 'function') {\n                result = fn(this.#isFullfilled() ? this.#data : this.#error.error);\n            }\n            if (isPromise(result)) {\n                (result as PromiseLike<T>).then(resolve, reject);\n                if (!this.#isFullfilled()) {\n                    (result as PromiseLike<T>).catch(reject);\n                }\n            } else if (this.#isFullfilled()) {\n                resolve(result);\n            } else {\n                reject(typeof result !== 'undefined' ? result : this.#error._error);\n            }\n        }\n    };\n\n    #callThen = (\n        resolveFn: Thenable<T>,\n        rejectFn?: Thenable<T>,\n        breakFn?: () => void\n    ): BreakablePromise<T | any> => {\n        return new BreakablePromise((resolve, reject, breakPromise) => {\n            if (!this.#isPending()) {\n                this.#checkState(resolve, reject, this.#isFullfilled() ? resolveFn : rejectFn);\n            } else {\n                const isSuccess = () => {\n                    this.#checkState(resolve, reject, resolveFn);\n                };\n                this.#emitter\n                    .once(EventTypes.SUCCESS, isSuccess)\n                    .once(EventTypes.FAILED, () => {\n                        this.#emitter.off(EventTypes.SUCCESS, isSuccess);\n                        this.#checkState(resolve, reject, rejectFn);\n                    });\n            }\n            if (typeof breakPromise === 'function') {\n                breakPromise(breakFn);\n            }\n        });\n    }\n\n    #callCatch = (\n        cb: Thenable<T>,\n        breakFn?: () => void\n    ): BreakablePromise<T | any> => {\n        return new BreakablePromise((resolve, reject, breakPromise) => {\n            if (!this.#isPending() && !this.#isFullfilled()) {\n                this.#checkState(resolve, reject, cb);\n            } else {\n                this.#emitter.once(EventTypes.FAILED, () => {\n                    this.#checkState(resolve, reject, cb);\n                });\n            }\n            if (typeof breakPromise === 'function') {\n                breakPromise(breakFn);\n            }\n        });\n    };\n\n    then(\n        resolveFn: Thenable<T>,\n        rejectFn?: Thenable<T>,\n        breakFn?: () => void\n    ): BreakablePromise<T | any> {\n        return this.#callThen(resolveFn, rejectFn, breakFn);\n    }\n\n    catch(\n        rejectFn: Thenable<T>,\n        breakFn?: () => void\n    ): BreakablePromise<T | any> {\n        return this.#callCatch(rejectFn, breakFn);\n    }\n\n    break(): BreakablePromise<any> {\n        return new BreakablePromise((resolve, reject) => {\n            if (this.#isBreakable) {\n                if (typeof this.#callBreak === 'function') {\n                    this.#callBreak();\n                    resolve();\n                } else {\n                    this.#emitter.once<VoidFn>(EventTypes.BREAKABLE, (callBreak) => {\n                        callBreak();\n                        resolve();\n                    });\n                }\n            } else {\n                reject();\n            }\n        });\n    }\n\n    isBroken(): boolean {\n        return this.#state === PromiseStates.BROKEN;\n    }\n\n    static resolve<U = any>(data: U): BreakablePromise<U> {\n        return new BreakablePromise<U>((resolve) => {\n            resolve(data);\n        });\n    }\n\n    static reject<U = any>(error: U): BreakablePromise<U> {\n        return new BreakablePromise<U>((_, reject) => {\n            reject(error);\n        });\n    }\n\n    static all<U>(promises: (Promise<U> | BreakablePromise<U>)[], breakFn?: () => void): BreakablePromise<U> {\n        return new BreakablePromise<any>((resolve, reject, breakPromise) => {\n            try {\n                const allPromises = [...promises];\n                const results: any[] = [];\n                for (const promise of allPromises) {\n                    promise.then((result: any) => {\n                        results.push(result);\n                    }).catch((error: any) => {\n                        throw new Error(error);\n                    });\n                }\n                resolve(results);\n                if (typeof breakPromise === 'function') {\n                    breakPromise(breakFn);\n                }\n            } catch (e) {\n                reject(e.message);\n            }\n        });\n    }\n}"],"names":["setImmediateFn","setImmediate","cb","setTimeout","EventEmitter","Math","round","random","eventType","events","push","currEventType","length","splice","indexOf","tempCallback","args","apply","off","on","forEach","fn","Error","err","error","e","_error","isCaught","PromiseStates","EventTypes","BreakablePromise","_classPrivateFieldGet","FULFILLED","PENDING","resolve","reject","isBroken","result","isPromise","then","resolveFn","rejectFn","breakFn","breakPromise","isSuccess","once","SUCCESS","FAILED","call","data","emit","BREAKABLE","REJECTED","callBreak","BROKEN","_","promises","allPromises","results","promise","message"],"mappings":"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"}